# Milvusæ··åˆæ£€ç´¢ç³»ç»Ÿ

åŸºäºMilvusçš„åŒ»å­¦æ•™ç§‘ä¹¦æ··åˆæ£€ç´¢ç³»ç»Ÿï¼Œç»“åˆBM25å…¨æ–‡æ£€ç´¢å’Œè¯­ä¹‰å‘é‡æ£€ç´¢ã€‚

## ğŸŒŸ ç‰¹æ€§

- **æ··åˆæ£€ç´¢**ï¼šç»“åˆBM25ç¨€ç–å‘é‡å’Œè¯­ä¹‰ç¨ å¯†å‘é‡ï¼Œæä¾›æ›´å‡†ç¡®çš„æ£€ç´¢ç»“æœ
- **å¤šç§æ£€ç´¢æ¨¡å¼**ï¼šæ”¯æŒç¨€ç–æ£€ç´¢ã€ç¨ å¯†æ£€ç´¢ã€æ··åˆæ£€ç´¢
- **å­¦ç§‘åˆ†ç±»**ï¼šæ”¯æŒ17ä¸ªåŒ»å­¦å­¦ç§‘çš„åˆ†ç±»æ£€ç´¢
- **çµæ´»çš„æ’åºç­–ç•¥**ï¼šæ”¯æŒRRFï¼ˆReciprocal Rank Fusionï¼‰å’ŒåŠ æƒæ’åº
- **å®Œå–„çš„å·¥ç¨‹å®è·µ**ï¼šç±»å‹æ³¨è§£ã€æ—¥å¿—è®°å½•ã€é”™è¯¯å¤„ç†ã€æ–‡æ¡£æ³¨é‡Š

## ğŸ“¦ å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd milvus-hybrid

# å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨uvï¼‰
uv sync

# æˆ–ä½¿ç”¨pip
pip install -e .
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ„å»ºå‘é‡æ•°æ®åº“

```bash
python -m src.build_db.build_db_from_txt \
    --data_path data/textbooks/text \
    --model_path model-hub/Qwen3-Embedding-0.6B
```

### 2. ä½¿ç”¨æ£€ç´¢å™¨

```python
from src.hybrid_retriever import HybridRetriever

# åˆå§‹åŒ–
retriever = HybridRetriever(
    uri="milvus_db_hub/med_corpus.db",
    collection_name="med_corpus",
    model_path="model-hub/Qwen3-Embedding-0.6B"
)

# æ‰§è¡Œæ··åˆæ£€ç´¢
results = retriever.hybrid_search("What is diabetes?", limit=5)
print(retriever.format_results(results))

# å…³é—­è¿æ¥
retriever.close()
```

### 3. è¿è¡Œç¤ºä¾‹

```bash
python examples/search_example.py
```

## ğŸ“– æ–‡æ¡£

è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£è¯·æŸ¥çœ‹ [docs/USAGE.md](docs/USAGE.md)

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
milvus-hybrid/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py                  # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ hybrid_retriever.py          # æ··åˆæ£€ç´¢å™¨ç±»
â”‚   â””â”€â”€ build_db/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ build_db_from_txt.py     # æ•°æ®åº“æ„å»ºè„šæœ¬
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ search_example.py            # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ USAGE.md                     # è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ data/
â”‚   â””â”€â”€ textbooks/                   # æ•™ç§‘ä¹¦æ•°æ®
â”œâ”€â”€ model-hub/
â”‚   â””â”€â”€ Qwen3-Embedding-0.6B/        # åµŒå…¥æ¨¡å‹
â””â”€â”€ milvus_db_hub/
    â””â”€â”€ med_corpus.db                # Milvusæ•°æ®åº“
```

## ğŸ”§ é…ç½®

### æ•°æ®åº“æ„å»ºå‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--uri` | `milvus_db_hub/med_corpus.db` | æ•°æ®åº“æ–‡ä»¶è·¯å¾„ |
| `--collection_name` | `med_corpus` | Collectionåç§° |
| `--data_path` | `data/textbooks/text` | æ–‡æœ¬æ•°æ®ç›®å½• |
| `--chunk_size` | `5000` | æ–‡æœ¬å—å¤§å° |
| `--chunk_overlap` | `500` | æ–‡æœ¬å—é‡å  |
| `--model_path` | `model-hub/Qwen3-Embedding-0.6B` | æ¨¡å‹è·¯å¾„ |
| `--batch_size` | `32` | æ‰¹å¤„ç†å¤§å° |

## ğŸ¯ æ”¯æŒçš„åŒ»å­¦å­¦ç§‘

- è§£å‰–å­¦ (Anatomy)
- ç”Ÿç†å­¦ (Physiology)
- ç”Ÿç‰©åŒ–å­¦ (Biochemistry)
- è¯ç†å­¦ (Pharmacology)
- ç—…ç†å­¦ (Pathology)
- å†…ç§‘å­¦ (InternalMed)
- å¤–ç§‘å­¦ (Surgery)
- å„¿ç§‘å­¦ (Pediatrics)
- å¦‡ç§‘å­¦ (Gynecology)
- äº§ç§‘å­¦ (Obstentrics)
- ç¥ç»å­¦ (Neurology)
- ç²¾ç¥ç—…å­¦ (Psichiatry)
- å…ç–«å­¦ (Immunology)
- ç»„ç»‡å­¦ (Histology)
- ç»†èƒç”Ÿç‰©å­¦ (Cell_Biology)
- æ€¥æ•‘ (First_Aid)
- ç—…ç†å­¦åŸºç¡€ (Pathoma)

## ğŸ“Š æ£€ç´¢æ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | ä¼˜åŠ¿ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| **ç¨€ç–æ£€ç´¢ï¼ˆBM25ï¼‰** | ç²¾ç¡®å…³é”®è¯åŒ¹é… | å·²çŸ¥æœ¯è¯­çš„æŸ¥è¯¢ |
| **ç¨ å¯†æ£€ç´¢ï¼ˆè¯­ä¹‰ï¼‰** | ç†è§£è¯­ä¹‰å’Œæ¦‚å¿µ | æ¦‚å¿µæ€§æŸ¥è¯¢ |
| **æ··åˆæ£€ç´¢** | ç»“åˆä¸¤è€…ä¼˜åŠ¿ | å¤§å¤šæ•°åœºæ™¯ |

## ğŸ› ï¸ ä»£ç ä¼˜åŒ–

### ä¸»è¦æ”¹è¿›

#### build_db_from_txt.py
- âœ… ä¿®å¤å‡½æ•°å‘½åæ‹¼å†™é”™è¯¯
- âœ… æ·»åŠ å®Œæ•´çš„ç±»å‹æ³¨è§£
- âœ… æ·»åŠ è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
- âœ… æ·»åŠ æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†
- âœ… æ”¹è¿›ä»£ç ç»“æ„å’Œå¯è¯»æ€§
- âœ… æ·»åŠ å‚æ•°éªŒè¯å’Œå¼‚å¸¸å¤„ç†
- âœ… è‡ªåŠ¨è·å–åµŒå…¥ç»´åº¦

#### hybrid_retriever.py
- âœ… å°è£…ä¸ºæ˜“ç”¨çš„ç±»
- âœ… æ”¯æŒå¤šç§æ£€ç´¢æ¨¡å¼
- âœ… æä¾›çµæ´»çš„è¿‡æ»¤å’Œæ’åºé€‰é¡¹
- âœ… å®Œå–„çš„æ—¥å¿—å’Œé”™è¯¯å¤„ç†
- âœ… ç»“æœæ ¼å¼åŒ–å·¥å…·
- âœ… èµ„æºç®¡ç†ï¼ˆè¿æ¥å…³é—­ï¼‰

## ğŸ’¡ æœ€ä½³å®è·µ

1. **é€‰æ‹©åˆé€‚çš„æ£€ç´¢æ¨¡å¼**
   - å…³é”®è¯æŸ¥è¯¢ â†’ ç¨€ç–æ£€ç´¢
   - æ¦‚å¿µæŸ¥è¯¢ â†’ ç¨ å¯†æ£€ç´¢
   - ä¸€èˆ¬æŸ¥è¯¢ â†’ æ··åˆæ£€ç´¢

2. **è°ƒæ•´èåˆç­–ç•¥**
   - é»˜è®¤ä½¿ç”¨RRFï¼ˆç®€å•æœ‰æ•ˆï¼‰
   - ç‰¹å®šéœ€æ±‚å¯ä½¿ç”¨åŠ æƒèåˆ

3. **ä¼˜åŒ–åˆ†å—ç­–ç•¥**
   - åŒ»å­¦æ–‡æœ¬æ¨è chunk_size=5000
   - chunk_overlapçº¦ä¸º10%

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

## ğŸ“ è®¸å¯è¯

MIT License

## ğŸ”— ç›¸å…³èµ„æº

- [Milvusæ–‡æ¡£](https://milvus.io/docs)
- [Sentence Transformers](https://www.sbert.net/)
- [LangChain](https://python.langchain.com/)

